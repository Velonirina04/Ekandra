{% extends 'Ekandra/base.html' %}
{% load static %}
{% load bootstrap5 %}
{% load i18n %}

{% block title %}Publier une offre{% endblock %}

{% block content %}
<style>
    /* --- Base Variables (Light Mode Defaults) --- */
    :root {
        --page-bg: #f5f7fa;
        --header-bg-start: #f8f9fa;
        --header-bg-end: #e9ecef;
        --header-text-primary: #3b82f6; /* Bootstrap primary */
        --header-text-muted: #6c757d; /* Bootstrap muted */
        --card-bg: white;
        --card-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        --input-border: #dee2e6;
        --input-focus-border: #4b6cb7;
        --input-focus-shadow: rgba(75, 108, 183, 0.25);
        --publish-btn-start: #4b6cb7;
        --publish-btn-end: #182848;
        --label-color: #495057;
        --form-text-color: #6c757d;
        --bs-success: #198754;
        --bs-danger: #dc3545;
        --bs-primary-rgb: 59, 130, 246; /* For rgba usage */
    }

    /* --- Dark Mode Variables (Activated by body.dark-mode class or system preference) --- */
    body.dark-mode :root, /* For JS toggle */
    @media (prefers-color-scheme: dark) { /* For system preference */
        :root {
            --page-bg: #1a202c; /* Dark background for the overall page */
            --header-bg-start: #2d3748; /* Darker header background */
            --header-bg-end: #1a202c; /* Even darker */
            --header-text-primary: #4361ee; /* Vibrant blue for dark mode */
            --header-text-muted: #a0aec0; /* Lighter muted for dark mode */
            --card-bg: #2d3748; /* Dark background for the form card */
            --card-shadow: 0 5px 25px rgba(0, 0, 0, 0.5); /* Deeper shadow */
            --input-border: #4a5568; /* Dark input field border */
            --input-focus-border: #4361ee; /* Dark mode primary for focus */
            --input-focus-shadow: rgba(67, 97, 238, 0.25); /* Dark mode primary shadow */
            --publish-btn-start: #4361ee; /* Dark mode primary for button */
            --publish-btn-end: #1e3a8a; /* Darker blue */
            --label-color: #f1f5f9; /* Light labels */
            --form-text-color: #a0aec0; /* Lighter form text */
            --bs-success: #10b981; /* Dark mode success green */
            --bs-danger: #ef4444; /* Dark mode danger red */
            --bs-primary-rgb: 67, 97, 238; /* Dark mode primary RGB */
        }
    }
    
    /* Global body transition for smooth mode change */
    body {
        transition: background-color 0.3s ease, color 0.3s ease;
        background-color: var(--page-bg); /* Apply base page background */
        color: var(--text-primary); /* Apply base text primary */
    }

    /* Styles améliorés avec animations */
    .header-section {
        background: linear-gradient(135deg, var(--header-bg-start) 0%, var(--header-bg-end) 100%);
        border-radius: 0 0 20px 20px;
        margin-bottom: 3rem !important;
        animation: fadeInDown 0.8s ease-out;
        color: var(--header-text-primary); /* Ensure header text is primary */
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); /* Light mode default */
        transition: background 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
    }
    body.dark-mode .header-section {
        box-shadow: var(--card-shadow); /* Dark mode shadow */
    }

    @keyframes fadeInDown {
        from {
            opacity: 0;
            transform: translateY(-30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .header-section .display-4 {
        color: var(--header-text-primary); /* Ensure header title uses the variable */
    }
    .header-section .lead {
        color: var(--header-text-muted); /* Ensure lead text uses the variable */
    }


    .form-card {
        border: none;
        background: var(--card-bg);
        box-shadow: var(--card-shadow);
        transition: all 0.3s ease;
        animation: fadeInUp 0.8s ease-out 0.2s both;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .form-card:hover {
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12); /* Slightly adjusted for dark mode, still uses black alpha */
        transform: translateY(-5px);
    }

    .form-control, .form-select {
        border: 1px solid var(--input-border);
        border-radius: 8px;
        padding: 12px 15px;
        transition: all 0.3s;
        background-color: var(--card-bg); /* Use card background for inputs initially */
        color: var(--label-color); /* Use label color for input text */
    }
    /* Placeholder color adjustment */
    .form-control::placeholder {
        color: var(--form-text-color) !important;
        opacity: 0.7;
    }

    .form-control:focus, .form-select:focus {
        border-color: var(--input-focus-border);
        box-shadow: 0 0 0 0.25rem var(--input-focus-shadow);
        background-color: var(--card-bg); /* Keep consistent on focus */
    }

    .publish-btn {
        background: linear-gradient(135deg, var(--publish-btn-start) 0%, var(--publish-btn-end) 100%);
        border: none;
        padding: 12px;
        font-weight: 600;
        letter-spacing: 0.5px;
        transition: all 0.3s;
        position: relative;
        overflow: hidden;
        color: white; /* Text color is always white for this button */
    }

    .publish-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(var(--bs-primary-rgb), 0.4); /* Use primary RGB for shadow */
    }

    .publish-btn::after {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: rgba(255, 255, 255, 0.1);
        transform: rotate(30deg);
        transition: all 0.3s;
    }

    .publish-btn:hover::after {
        left: 100%;
    }

    /* Style pour les labels */
    .form-label {
        font-weight: 600;
        color: var(--label-color);
        margin-bottom: 8px;
        transition: color 0.3s ease;
    }

    /* Style pour les messages d'aide */
    .form-text {
        font-size: 0.85rem;
        color: var(--form-text-color) !important;
        transition: color 0.3s ease;
    }

    /* Animation pour les champs du formulaire */
    .form-group {
        animation: fadeIn 0.5s ease-out;
        animation-fill-mode: backwards;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateX(-10px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    /* Délais d'animation pour chaque champ */
    .form-group:nth-child(1) { animation-delay: 0.3s; }
    .form-group:nth-child(2) { animation-delay: 0.4s; }
    .form-group:nth-child(3) { animation-delay: 0.5s; }
    .form-group:nth-child(4) { animation-delay: 0.6s; }
    .form-group:nth-child(5) { animation-delay: 0.7s; }
    .form-group:nth-child(6) { animation-delay: 0.8s; }
    .form-group:nth-child(7) { animation-delay: 0.9s; }
    .form-group:nth-child(8) { animation-delay: 1.0s; }
    .form-group:nth-child(9) { animation-delay: 1.1s; }
    .form-group:nth-child(10) { animation-delay: 1.2s; }

    /* Icône animée dans le header */
    .bi-briefcase-fill {
        animation: bounce 2s infinite;
    }

    @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-5px); }
    }

    /* Validation feedback colors */
    .is-valid {
        border-color: var(--bs-success) !important;
    }
    .is-invalid {
        border-color: var(--bs-danger) !important;
    }
    .valid-feedback {
        color: var(--bs-success) !important;
    }
    .invalid-feedback {
        color: var(--bs-danger) !important;
    }
    body.dark-mode .spinner-border {
        color: white; /* Ensure spinner is visible in dark mode */
    }
</style>

<div class="header-section text-center mb-5 pt-5 pb-4">
    <h1 class="display-4 fw-bold text-primary mb-3">
        <i class="bi bi-briefcase-fill me-2"></i> Publier une nouvelle offre d'emploi
    </h1>
    <p class="lead text-muted">Remplissez les détails ci-dessous pour ajouter votre opportunité professionnelle et toucher les meilleurs talents.</p>
</div>

<div class="row justify-content-center">
    <div class="col-md-9 col-lg-7">
        <div class="card form-card shadow-lg border-0 rounded-4">
            <div class="card-body p-4 p-md-5">
                <form method="post" class="offer-form needs-validation" novalidate>
                    {% csrf_token %}

                    {% bootstrap_form form show_help=True show_errors=True %}

                    <button type="submit" class="btn btn-primary btn-lg w-100 mt-4 publish-btn">
                        <i class="bi bi-send-fill me-2"></i> Publier l'offre
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
    {# No need for an external CSS file specifically for this page now, as styles are embedded #}
    {# If create_offre.css contains GLOBAL styles, keep it. Otherwise, remove if it's only for this page. #}
    {# Assuming `create_offre.css` contains global styles not specific to this page, keep it. #}
    <link rel="stylesheet" href="{% static 'Ekandra/css/create_offre.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
{% endblock %}

{% block extra_js %}
<script src="{% static 'Ekandra/js/sombre.js' %}"></script>
<script>
    // Ajout d'une validation en temps réel
    document.addEventListener('DOMContentLoaded', function() {
        // Sélectionner tous les champs requis
        const requiredFields = document.querySelectorAll('[required]');
        
        requiredFields.forEach(field => {
            field.addEventListener('input', function() {
                if (this.value.trim() !== '') {
                    this.classList.remove('is-invalid');
                    this.classList.add('is-valid');
                } else {
                    this.classList.remove('is-valid');
                    // Add is-invalid if field is empty and was touched/not valid before submission
                    if (this.closest('.form-group').classList.contains('was-validated') || this.classList.contains('is-invalid')) {
                         this.classList.add('is-invalid');
                    }
                }
            });

            // Ensure field is marked invalid on blur if it's required and empty
            field.addEventListener('blur', function() {
                if (this.value.trim() === '' && this.hasAttribute('required')) {
                    this.classList.add('is-invalid');
                    this.classList.remove('is-valid');
                }
            });
        });

        // Animation supplémentaire lors de la soumission
        const form = document.querySelector('.offer-form');
        form.addEventListener('submit', function(e) {
            // Check Bootstrap's validation state before proceeding with animation
            if (!form.checkValidity()) {
                e.preventDefault();
                e.stopPropagation();
                // Add was-validated class to show validation feedback
                form.classList.add('was-validated');
                return; // Stop if form is invalid
            }

            const submitBtn = document.querySelector('.publish-btn');
            submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> Publication en cours...';
            submitBtn.disabled = true;
            // Add was-validated class for Bootstrap's validation styling
            form.classList.add('was-validated');
        });

        // Bootstrap's default validation behavior (important for initial check)
        var forms = document.querySelectorAll('.needs-validation')
        Array.prototype.slice.call(forms)
            .forEach(function (form) {
                form.addEventListener('submit', function (event) {
                    if (!form.checkValidity()) {
                        event.preventDefault()
                        event.stopPropagation()
                    }
                    form.classList.add('was-validated')
                }, false)
            })
    });
</script>
{% endblock %}